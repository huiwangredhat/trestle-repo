name: Check for New 'sync_cac/' Branches and Create PR

on:
  schedule:
    - cron: '0 12 * * *'  # Run daily at 12:00 PM (adjust as necessary)
  workflow_dispatch:  # Allows manual triggering of the workflow

jobs:
  create-pr-for-new-branches:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout the repository code
        uses: actions/checkout@v4

      - name: Fetch all remote branches
        run: |
          git fetch --all
          echo "Fetching all branches from the remote repository."

      - name: Get list of sync_cac/ branches
        id: get-sync-cac-branches
        run: |
          # List all remote branches starting with 'sync_cac/'
          sync_cac_branches=$(git branch -r | grep 'origin/sync_cac/' | sed 's/origin\///')
          echo "sync_cac/ branches found: $sync_cac_branches"
          gh auth login --with-token ${{ secrets.GITHUB_TOKEN }}
          # Create a PR for each new sync_cac/ branch
          for branch in $sync_cac_branches; do
            echo "Creating PR for new branch: $branch"
            gh pr create --base main --head $branch --title "Auto PR for $branch" --body "This is an auto-created PR for the new branch $branch" --label "auto-pr" --draft 
          done